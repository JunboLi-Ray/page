四 事务

事务分
扁平事务：都开始都恢复
链事务：多个阶段，多恢复点
嵌套事务：树状
分布事务：分布式多个系统，两段提交

实现通过
redo日志：记录了操作的结果，对应物理页修改。每个页有一个lsn，记录修改序列号，通过号差决定恢复哪些。
undo日志：记录操作逻辑，可反操作sql完成回滚。其它事物可通过undo日志读取原值，mvcc：多版本控制，实现不加锁读，只在rr和rc工作。

还有一个二进制日志，对应sql语句，mysql生成用于恢复，不是存储引擎生成。

purge：用于事务统一删除或更新数据，为了实现mvcc。你看到的删除只是标记为删除。实际删除时，也会删除undolog。

自动提交默认开启

默认隔离级别 repeatable read


rc和rr下幻读：
快照读：查询，mvcc解决
当前读：更改，gap间隙锁解决

并发控制方式：
mvcc，基于版本不加锁，分快照读和当前读。
lbcc，基于锁。