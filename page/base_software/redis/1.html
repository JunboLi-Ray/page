redis机制

100ms一次serverCron

用惰性删除（每次取都检查）和定期删除（时间内，循环库在库里随机取一个判断）

RDB
记录数据
RDB主服务器都判断过期，从服务器只在读取时不判断过期
SAVE BGSAVE（子进程）
启动没开aof且有rdb文件，就加载
判断某段时间是否达到操作次数达到就存

AOF append only file
记录操作
aof缓冲区写入aof文件（在系统write缓冲区）同步aof文件（将缓冲区文件写入aof文件）
aof重写（子进程，根据库状态减少纪录的指令，用新aof替换）

键空间通知，某个键执行了什么命令
键事件通知，哪些键执行了这个命令

文件事件，时间事件
周期性执行先等待事件，到时间了执行时间。因同步执行，时间事件执行比预计时间晚。

<img>


内存不够，会将不怎么使用的key的value存入硬盘并删除内存占用。

内存分配交由三方，默认jemalloc，类似物流分配，小的线程内，大的再麻烦取

redis hash 算法 siphash

节点down掉后，会故障转移，选从节点为主。
集群通信有meet、ping、pong、publish、fail。

订阅频道，订阅模式，可能一个消息收两遍


二进制操作计录是倒序，为setbit操作

排序指令，建数组指向，然后排序数组，快排

lua支持
eval执行，生成sha为名称de方法，可以下次调用

监控节点可以监控执行的指令